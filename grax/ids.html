<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ids | RDF on Elixir</title>
    <meta name="description" content="Implementation of the Linked Data and Semantic Standards for Elixir">
    <link rel="manifest" href="/icons/manifest.json">
  <link rel="icon" type="image/x-icon" sizes="16x16 32x32" href="/icons/favicon.ico">
  <link rel="icon" sizes="192x192" href="/icons/favicon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/favicon-180-precomposed.png">
  <meta name="msapplication-TileImage" content="/icons/favicon-144.png">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.26047e9a.css" as="style"><link rel="preload" href="/assets/js/app.9947d21f.js" as="script"><link rel="preload" href="/assets/js/2.9c83fda1.js" as="script"><link rel="preload" href="/assets/js/12.6022d75e.js" as="script"><link rel="preload" href="/assets/js/3.6456fe17.js" as="script"><link rel="prefetch" href="/assets/js/10.ee4ed3c6.js"><link rel="prefetch" href="/assets/js/11.467615b9.js"><link rel="prefetch" href="/assets/js/13.b74f4730.js"><link rel="prefetch" href="/assets/js/14.16bc6703.js"><link rel="prefetch" href="/assets/js/15.b2a2c70a.js"><link rel="prefetch" href="/assets/js/16.16aff3dd.js"><link rel="prefetch" href="/assets/js/17.e92fb19a.js"><link rel="prefetch" href="/assets/js/18.029f34a1.js"><link rel="prefetch" href="/assets/js/19.05cb4c74.js"><link rel="prefetch" href="/assets/js/20.269187c7.js"><link rel="prefetch" href="/assets/js/21.bb8ba48a.js"><link rel="prefetch" href="/assets/js/22.3ae550ed.js"><link rel="prefetch" href="/assets/js/23.fd1aa42f.js"><link rel="prefetch" href="/assets/js/24.da208f76.js"><link rel="prefetch" href="/assets/js/25.0da14ab4.js"><link rel="prefetch" href="/assets/js/26.db8227de.js"><link rel="prefetch" href="/assets/js/27.4c9e9654.js"><link rel="prefetch" href="/assets/js/28.54a222e6.js"><link rel="prefetch" href="/assets/js/29.bf2a75a3.js"><link rel="prefetch" href="/assets/js/30.1a834a5c.js"><link rel="prefetch" href="/assets/js/31.e898f5f2.js"><link rel="prefetch" href="/assets/js/32.1235ec14.js"><link rel="prefetch" href="/assets/js/33.abbed48e.js"><link rel="prefetch" href="/assets/js/34.4b01380f.js"><link rel="prefetch" href="/assets/js/35.3d8d8b6b.js"><link rel="prefetch" href="/assets/js/36.6466eb8a.js"><link rel="prefetch" href="/assets/js/37.d63216a3.js"><link rel="prefetch" href="/assets/js/38.5f244a36.js"><link rel="prefetch" href="/assets/js/39.292a3e39.js"><link rel="prefetch" href="/assets/js/4.54ba1511.js"><link rel="prefetch" href="/assets/js/40.feb4961e.js"><link rel="prefetch" href="/assets/js/5.d4e734fc.js"><link rel="prefetch" href="/assets/js/6.dd985d23.js"><link rel="prefetch" href="/assets/js/7.98d61040.js"><link rel="prefetch" href="/assets/js/8.86f42866.js"><link rel="prefetch" href="/assets/js/9.5dff1e2d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.26047e9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">RDF on Elixir</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/rdf-ex/" class="nav-link">RDF.ex</a></div><div class="nav-item"><a href="/sparql-ex/" class="nav-link">SPARQL.ex</a></div><div class="nav-item"><a href="/shex-ex/" class="nav-link">ShEx.ex</a></div><div class="nav-item"><a href="/grax/" class="nav-link router-link-active">Grax</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API Documentation</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/rdf/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RDF.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/sparql/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  SPARQL.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/sparql_client/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  SPARQL.Client
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/shex/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ShEx.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/json_ld/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON-LD.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/rdf_xml/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RDF-XML.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/links.html" class="nav-link">Links</a></div> <a href="https://github.com/rdf-elixir/website" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/rdf-ex/" class="nav-link">RDF.ex</a></div><div class="nav-item"><a href="/sparql-ex/" class="nav-link">SPARQL.ex</a></div><div class="nav-item"><a href="/shex-ex/" class="nav-link">ShEx.ex</a></div><div class="nav-item"><a href="/grax/" class="nav-link router-link-active">Grax</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API Documentation</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/rdf/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RDF.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/sparql/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  SPARQL.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/sparql_client/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  SPARQL.Client
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/shex/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ShEx.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/json_ld/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON-LD.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://hexdocs.pm/rdf_xml/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RDF-XML.ex
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/links.html" class="nav-link">Links</a></div> <a href="https://github.com/rdf-elixir/website" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Grax</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/grax/" class="sidebar-link">Introduction</a></li><li><a href="/grax/installation.html" class="sidebar-link">Installation</a></li><li><a href="/grax/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/grax/api.html" class="sidebar-link">API</a></li><li><a href="/grax/ids.html" class="active sidebar-link">Ids</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/grax/ids.html#namespaces" class="sidebar-link">Namespaces</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#id-schemas" class="sidebar-link">Id schemas</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#using-id-schemas" class="sidebar-link">Using id schemas</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#connecting-id-schemas-with-grax-schemas" class="sidebar-link">Connecting id schemas with Grax schemas</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#custom-variables" class="sidebar-link">Custom variables</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#auto-incremented-counters" class="sidebar-link">Auto-incremented counters</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#hash-ids" class="sidebar-link">Hash ids</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#uuids" class="sidebar-link">UUIDs</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#urns" class="sidebar-link">URNs</a></li><li class="sidebar-sub-header"><a href="/grax/ids.html#blank-nodes" class="sidebar-link">Blank nodes</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ids"><a href="#ids" aria-hidden="true" class="header-anchor">#</a> Ids</h1> <p>In the last chapter about the API we saw that we'll have to provide a URI (or blank node) identifier when building a new resource with <code>Grax.build/2</code>. Minting an identifier for a new resource is a non-trivial step as these identifiers must be unique and (in most cases) persistent, i.e. should not change over the course of the lifetime of the resource. So, it would be good if the identifier creation logic wouldn't be scattered around the code base wherever we are building new resources. For this purpose, we can define the identifier creation logic in one central place with Grax id specs.
A Grax id spec is a module which uses <code>Grax.Id.Spec</code> macros to the define the overall identifier namespace structure and the specific rules for the creation of identifiers for the Grax schemas of our application.
This chapter explains the definition and use of those Grax id specs and enable you to implement common <a href="https://patterns.dataincubator.org/book/identifier-patterns.html" target="_blank" rel="noopener noreferrer">identifier patterns<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="namespaces"><a href="#namespaces" aria-hidden="true" class="header-anchor">#</a> Namespaces</h2> <p>A Grax id spec module first has to <code>use Grax.Id.Spec</code> to make the necessary macros available. With that, you can start to lay out the structure of the namespace the identifiers with the <code>namespace/1</code> macro. It takes a string with a fragment of a URI and a <code>do</code> block which consists of nested <code>namespace</code> calls or definitions of id schemas, which we'll discuss later. The outermost <code>namespace</code> call must be an absolute URI and can be given also a namespace vocabulary term instead of a string, while the nested namespaces just define a fragment string which will be concatenated to parent namespace.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;foo/&quot;</span> <span class="token keyword">do</span>
    <span class="token keyword">end</span>

    namespace <span class="token string">&quot;bar#&quot;</span> <span class="token keyword">do</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>This example defines three namespaces in which we can put our id schemas:</p> <ol><li><code>http://example.com/</code></li> <li><code>http://example.com/foo/</code></li> <li><code>http://example.com/bar#</code></li></ol> <p>You can also define an optional prefix for a namespace with the <code>prefix</code> keyword argument on a <code>namespace</code> call.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;foo/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:foo</span> <span class="token keyword">do</span>
    <span class="token keyword">end</span>

    namespace <span class="token string">&quot;bar#&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:bar</span> <span class="token keyword">do</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>The Grax id spec module provides a <code>prefix_map/0</code> function which returns a <code>RDF.PrefixMap</code> you can pass to the RDF serialization functions (see <a href="/rdf-ex/serializations.html#managing-prefixes">this section in the RDF.ex guide</a> for more on this).</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Example<span class="token punctuation">.</span>IdSpec<span class="token punctuation">.</span>prefix_map<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span>RDF<span class="token punctuation">.</span>PrefixMap<span class="token punctuation">{</span>
  <span class="token attr-name">bar:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>bar<span class="token comment">#&gt;,</span>
  <span class="token attr-name">foo:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>foo<span class="token operator">/</span>&gt;
<span class="token punctuation">}</span>
</code></pre></div><p>Unless you provide other prefixes on <code>Grax.to_rdf/1</code> it will use this prefix map automatically to add them to the created graph, so that they in turn will be used on serialization.</p> <p>The URI of one single namespace can be defined as the base URI by using the <code>base</code> macro instead of the <code>namespace</code>.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    base <span class="token string">&quot;foo/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:foo</span> <span class="token keyword">do</span>
    <span class="token keyword">end</span>

    namespace <span class="token string">&quot;bar#&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:bar</span> <span class="token keyword">do</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>The <code>base_iri/0</code> function of the Grax id spec module will return the <code>RDF.IRI</code> of this namespace.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Example<span class="token punctuation">.</span>IdSpec<span class="token punctuation">.</span>base_iri<span class="token punctuation">(</span><span class="token punctuation">)</span>
~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>foo<span class="token operator">/</span>&gt;
</code></pre></div><p>As we will see later, namespaces can also act as containers for shared arguments of its id schemas, but let's introduce id schemas properly first.</p> <h2 id="id-schemas"><a href="#id-schemas" aria-hidden="true" class="header-anchor">#</a> Id schemas</h2> <p>An id schema for a Grax schema can be defined in the most generic way with the <code>id_schema/2</code> macro inside a <code>namespace</code> block. It expects an URI template according to <a href="https://en.wikipedia.org/wiki/URI_Template" target="_blank" rel="noopener noreferrer">RFC 6570<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as the first argument and something to specify on which Grax schemas this id schema should be applied, most of the time by specifying the schema (or multiple schemas as a list) directly with the <code>schema</code> keyword argument. You can use the properties of the Grax schema as parameters in the URI template.</p> <p>Let's say we have a <code>Book</code> Grax schema defined with an <code>:isbn</code> property we'd like to use as the basis for its ids. We can define an id schema for the <code>Book</code> schema like this:</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    id_schema <span class="token string">&quot;books/{isbn}&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">schema:</span> Book
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>As we've said, most of the time the Grax schema on which the id schema should be applied is given directly. For this form, the <code>id</code> macro provides a more succinct but semantically equivalent form. So, the following is an equivalent definition of the same id schema:</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    id Book<span class="token punctuation">,</span> <span class="token string">&quot;books/{isbn}&quot;</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>For cases, where template consists solely of a template parameter with a property from the schema, an even shorter form is supported by the <code>id</code> macro, where the property is written in the typical dot syntax after the schema. In our book example however, we don't have this simple template form, but we can get it simple into that form, by introducing a separate sub namespace, which might have been a good idea in the first place, since it allows us to define a prefix for this namespace.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;books/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:book</span> <span class="token keyword">do</span>
      id Book<span class="token punctuation">.</span>isbn
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>Again, this id schema will produce the same ids as the previous forms.</p> <p>Before we look at more techniques to define id schemas, let's look at how we can use id schemas.</p> <h2 id="using-id-schemas"><a href="#using-id-schemas" aria-hidden="true" class="header-anchor">#</a> Using id schemas</h2> <p>With the id schema we've created in the previous section a new book can now be build without having to provide an id:</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Book<span class="token punctuation">.</span>build!<span class="token punctuation">(</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">,</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span>Book<span class="token punctuation">{</span>
  <span class="token attr-name">__id__:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>books<span class="token operator">/</span><span class="token number">1680508407</span>&gt;<span class="token punctuation">,</span>
  <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">,</span>
  <span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span>
<span class="token punctuation">}</span>       
</code></pre></div><p>This also makes it particularly easy to build nested graph structures, where we can provide linked resources just as a map (as long as everything is included to produce the ids). Let's suppose we also have an <code>:author</code> link property in our <code>Book</code> schema which links to an <code>Author</code> schema with an id schema, which for the sake of simplicity is based on the name (although this is not a good idea in terms of uniqueness). This allows us to build a our book like this:</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Book<span class="token punctuation">.</span>build!<span class="token punctuation">(</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">,</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span><span class="token punctuation">)</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">author:</span> <span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">first_name:</span> <span class="token string">&quot;Tony&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">last_name:</span> <span class="token string">&quot;Hammond&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span>Book<span class="token punctuation">{</span>
  <span class="token attr-name">__id__:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>books<span class="token operator">/</span><span class="token number">1680508407</span>&gt;<span class="token punctuation">,</span>
  <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">,</span>
  <span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span><span class="token punctuation">,</span>
  <span class="token attr-name">author:</span> <span class="token punctuation">[</span><span class="token punctuation">%</span>Author<span class="token punctuation">{</span>
    <span class="token attr-name">__id__:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>authors<span class="token operator">/</span>Tony_Hammond<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attr-name">first_name:</span> <span class="token string">&quot;Tony&quot;</span><span class="token punctuation">,</span> 
    <span class="token attr-name">last_name:</span> <span class="token string">&quot;Hammond&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>       
</code></pre></div><h2 id="connecting-id-schemas-with-grax-schemas"><a href="#connecting-id-schemas-with-grax-schemas" aria-hidden="true" class="header-anchor">#</a> Connecting id schemas with Grax schemas</h2> <p>But how are Grax schemas and Grax id specs actually connected? How does Grax know in which id spec to search for an id schema?</p> <p>The most direct option is to specify the <code>Grax.Id.Spec</code> module on a Grax schema with the <code>id_spec</code> keyword argument.</p> <div class="language-elixir extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Book <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Schema<span class="token punctuation">,</span> <span class="token attr-name">id_spec:</span> Example<span class="token punctuation">.</span>IdSpec
  
  <span class="token keyword">alias</span> NS<span class="token punctuation">.</span>SchemaOrg

  schema SchemaOrg<span class="token punctuation">.</span>Book <span class="token keyword">do</span>
    property <span class="token atom symbol">:title</span><span class="token punctuation">,</span> SchemaOrg<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token attr-name">type:</span> <span class="token atom symbol">:string</span><span class="token punctuation">,</span> <span class="token attr-name">required:</span> <span class="token boolean">true</span>
    property <span class="token atom symbol">:isbn</span><span class="token punctuation">,</span> SchemaOrg<span class="token punctuation">.</span>isbn<span class="token punctuation">,</span> <span class="token attr-name">type:</span> <span class="token atom symbol">:string</span><span class="token punctuation">,</span> <span class="token attr-name">required:</span> <span class="token boolean">true</span>

    link <span class="token atom symbol">:author</span><span class="token punctuation">,</span> SchemaOrg<span class="token punctuation">.</span>author<span class="token punctuation">,</span> <span class="token attr-name">type:</span> list_of<span class="token punctuation">(</span>Author<span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>However, this won't be needed most of the time, since an application will usually have just one id spec for all Grax schemas. This id spec module can be configured with the <code>:grax_id_spec</code> key under the configuration of your application. So, for an application with the name <code>:my_app</code> this configuration would look like this:</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">use</span> Mix<span class="token punctuation">.</span>Config

config <span class="token atom symbol">:my_app</span><span class="token punctuation">,</span>
  <span class="token attr-name">grax_id_spec:</span> Example<span class="token punctuation">.</span>IdSpec
</code></pre></div><p>For all Grax schemas defined in the <code>:my_app</code> application the id spec module specified like this will be search for an id schema (unless another id spec module is specified directly with <code>id_spec</code> keyword directly in the Grax schema).</p> <p>For an id schema which directly specifies the Grax schema(s) on which it should be applied, finding the id spec is everything that's needed. The id schema with the matching Grax schema must be simply looked up. On a <code>build</code> call the Grax schema is directly available (either the one passed to <code>Grax.build/2</code> or the module on which we call the <code>build/1</code> function). When the id generation is used to build nested Grax schemas the schema specified as the type of the link property is used for the lookup. For heterogenous properties however the schema is not determined, therefore the automatic building of nested Grax schemas is not supported on heterogenous links and you'll have to build and create the identifier for these manually.</p> <h3 id="custom-schema-selectors"><a href="#custom-schema-selectors" aria-hidden="true" class="header-anchor">#</a> Custom schema selectors</h3> <p>Sometimes however we want to define an id schema for whole groups of classes. For example, think of Wikidata URIs, where we have just a few kinds of identifiers. In scenarios like these we don't want to have to enumerate all Grax schemas on an id schema. We can define a custom selector function instead with the <code>:selector</code> keyword argument on the <code>id_schema</code> macro (the <code>id</code> macro works with directly given Grax schemas only). The function will be called with the Grax schema module and the map of key-value pairs which were passed on the <code>build</code> function call. It is expected to return a boolean which signals if the id schema on this Grax schema with these values should be applied.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    id_schema <span class="token string">&quot;books/{isbn}&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">selector:</span> <span class="token atom symbol">:example_selector</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> example_selector<span class="token punctuation">(</span>Book<span class="token punctuation">,</span> initial_values<span class="token punctuation">)</span> <span class="token keyword">do</span>
    IO<span class="token punctuation">.</span>inspect<span class="token punctuation">(</span>initial_values<span class="token punctuation">)</span>
    <span class="token boolean">true</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> example_selector<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">do:</span> <span class="token boolean">false</span>
<span class="token keyword">end</span>
</code></pre></div><p>In this example we return <code>true</code> for all <code>Book</code> schema requests, making it essentially behave exactly like our previous examples. We just also output the second argument to demonstrate what else we have available to determine an id schema.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Book<span class="token punctuation">.</span>build!<span class="token punctuation">(</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">,</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">%</span>Book<span class="token punctuation">{</span>
  <span class="token attr-name">__id__:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>books<span class="token operator">/</span><span class="token number">1680508407</span>&gt;<span class="token punctuation">,</span>
  <span class="token attr-name">title:</span> <span class="token string">&quot;Exploring Graphs with Elixir&quot;</span><span class="token punctuation">,</span>
  <span class="token attr-name">isbn:</span> <span class="token string">&quot;1680508407&quot;</span>
<span class="token punctuation">}</span>       
</code></pre></div><h2 id="custom-variables"><a href="#custom-variables" aria-hidden="true" class="header-anchor">#</a> Custom variables</h2> <p>Obviously, we will not always have a property available to use in our templates. Either we need to process an existing property value or there are template parameters which are completely independent of the properties of a Grax schema. For these situations we can define a variable processing or generating function and associate it with our id schema via the <code>var_mapping</code> keyword argument. This function will receive a map of all properties and their values and is expected to return an <code>:ok</code> tuple with an updated map which should be used to resolve the variable in the URI template.</p> <p>Let's say we want to use the slugified title our our <code>Post</code> schema from the previous chapters.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    id Post<span class="token punctuation">,</span> <span class="token string">&quot;posts/{slug}&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">var_mapping:</span> <span class="token atom symbol">:slugify_title</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> slugify_title<span class="token punctuation">(</span><span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">title:</span> title<span class="token punctuation">}</span> <span class="token operator">=</span> vars<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token punctuation">{</span><span class="token atom symbol">:ok</span><span class="token punctuation">,</span> 
      Map<span class="token punctuation">.</span>put<span class="token punctuation">(</span>vars<span class="token punctuation">,</span> <span class="token atom symbol">:slug</span><span class="token punctuation">,</span> 
           title
           <span class="token operator">|&gt;</span> to_string<span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token operator">|&gt;</span> String<span class="token punctuation">.</span>downcase<span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token operator">|&gt;</span> String<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> slugify_title<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token punctuation">{</span><span class="token atom symbol">:error</span><span class="token punctuation">,</span> <span class="token string">&quot;missing :title value for URI generation&quot;</span><span class="token punctuation">}</span>
  <span class="token keyword">end</span> 
<span class="token keyword">end</span>
</code></pre></div><p>The passed variables map will also include a special <code>:__schema__</code> value with Grax schema for which the id is requested. This can be very useful when the id schema is used for multiple Grax schemas. You can then pattern match on the <code>:__schema__</code> field and provide different variable processing logic for the different Grax schemas.</p> <h2 id="auto-incremented-counters"><a href="#auto-incremented-counters" aria-hidden="true" class="header-anchor">#</a> Auto-incremented counters</h2> <p>If you want to base the ids of a schema on an auto-incremented counter, you can do so by defining a counter on your id schema with the <code>counter</code> keyword argument, which will define a persistent counter with the given name. Every time a new instance of a schema is created with the <code>build</code> functions this counter will be automatically increased. You can include the value of the counter in your URI templates with the <code>counter</code> variable.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
      id Post<span class="token punctuation">,</span> <span class="token string">&quot;posts/{counter}&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">counter:</span> <span class="token atom symbol">:posts</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Post<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token attr-name">title:</span> <span class="token string">&quot;Foo&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span>Post<span class="token punctuation">{</span>
  <span class="token attr-name">__id__:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>posts<span class="token operator">/</span><span class="token number">1</span>&gt;<span class="token punctuation">,</span>
  <span class="token attr-name">author:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>
  <span class="token attr-name">content:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>
  <span class="token attr-name">title:</span> <span class="token string">&quot;Foo&quot;</span>
<span class="token punctuation">}</span>
iex<span class="token operator">&gt;</span> Post<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token attr-name">title:</span> <span class="token string">&quot;Bar&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span>Post<span class="token punctuation">{</span>
  <span class="token attr-name">__id__:</span> ~I<span class="token operator">&lt;</span><span class="token attr-name">http:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>posts<span class="token operator">/</span><span class="token number">2</span>&gt;<span class="token punctuation">,</span>
  <span class="token attr-name">author:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>
  <span class="token attr-name">content:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>
  <span class="token attr-name">title:</span> <span class="token string">&quot;Bar&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The abbreviated dot operator syntax when the template consists of a variable only is also supported for the counter variable:</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;posts/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:post</span> <span class="token keyword">do</span>
      id Post<span class="token punctuation">.</span>counter<span class="token punctuation">,</span> <span class="token attr-name">counter:</span> <span class="token atom symbol">:posts</span>
    <span class="token keyword">end</span>  
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>You can also share the same counter between different schemas just by using the same name on the <code>counter</code> keyword argument, for example to define Wikidata-like id schemas with counters for different categories of classes.</p> <p>By default the counters are persisted in DETS tables, each in dedicated files with the name of the counter accordingly. The path where these are stored can be configured with the <code>counter_dir</code> option in your Mix config (default is the current directory):</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">use</span> Mix<span class="token punctuation">.</span>Config

config <span class="token atom symbol">:grax</span><span class="token punctuation">,</span> <span class="token attr-name">counter_dir:</span> <span class="token string">&quot;example/counters/&quot;</span>
</code></pre></div><p>When you want to use a completely different way to manage and store your counters, you can define your own by implementing the <code>Grax.Id.Counter.Adapter</code> behaviour. The default adapter we've been using above is the <code>Grax.Id.Counter.Dets</code> implementation. An alternative implementation which simple stores a counter in a text file is available with <code>Grax.Id.Counter.TextFile</code>. This implementation however shouldn't be used in production. It just serves as a reference implementation and is only useful in tests or very simple scenarios.</p> <p>Another adapter can be set on an individual id schema with the <code>counter_adapter</code> keyword argument.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;posts/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:post</span> <span class="token keyword">do</span>
      id Post<span class="token punctuation">.</span>counter<span class="token punctuation">,</span> <span class="token attr-name">counter:</span> <span class="token atom symbol">:posts</span><span class="token punctuation">,</span> <span class="token attr-name">counter_adapter:</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Counter<span class="token punctuation">.</span>TextFile
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>An adapter can also be set as the default counter adapter with the <code>counter_adapter</code> keyword either on a namespace or for a whole id spec on the <code>use Grax.Id.Spec</code> call.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec<span class="token punctuation">,</span> <span class="token attr-name">counter_adapter:</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Counter<span class="token punctuation">.</span>TextFile

  namespace <span class="token string">&quot;http://example.com/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">counter_adapter:</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Counter<span class="token punctuation">.</span>Dets <span class="token keyword">do</span>
    namespace <span class="token string">&quot;posts/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">prefix:</span> <span class="token atom symbol">:post</span> <span class="token keyword">do</span>
      id Post<span class="token punctuation">.</span>counter<span class="token punctuation">,</span> <span class="token attr-name">counter:</span> <span class="token atom symbol">:posts</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><h2 id="hash-ids"><a href="#hash-ids" aria-hidden="true" class="header-anchor">#</a> Hash ids</h2> <p>If you want to base your identifiers on cryptographic hashes, you can use the <code>hash</code> macro from the <code>Grax.Id.Hash</code> extension. It works as a replacement for the <code>id</code> macro and provides an additional <code>hash</code> variable for use in the template given with the <code>:template</code> keyword argument. The property from which the hash is computed is given with the <code>:data</code> keyword argument and the hashing algorithm must be specified with the <code>:algorithm</code> argument. The names of the algorithms are passed down to Erlang hash function, so please refer to the <a href="https://erlang.org/doc/man/crypto.html#type-hash_algorithm" target="_blank" rel="noopener noreferrer">Erlang documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> of your version, for which ones are available.</p> <p>Let's use our <code>Post</code> schema from the last chapters as an example again.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec
  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Hash

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    hash Post<span class="token punctuation">,</span> <span class="token attr-name">template:</span> <span class="token string">&quot;posts/{hash}&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">data:</span> <span class="token atom symbol">:content</span><span class="token punctuation">,</span> <span class="token attr-name">algorithm:</span> <span class="token atom symbol">:sha256</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>There are various ways this can be shortened. First, we can introduce again an additional namespace for <code>posts/</code>, so that the <code>template</code> would become <code>&quot;{hash}&quot;</code>, which we can omit, since it is the default template used in the <code>hash</code> macro.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec
  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Hash

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;foo/&quot;</span> <span class="token keyword">do</span>
      hash Post<span class="token punctuation">,</span> <span class="token attr-name">data:</span> <span class="token atom symbol">:content</span><span class="token punctuation">,</span> <span class="token attr-name">algorithm:</span> <span class="token atom symbol">:sha256</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>Next, instead of providing the property with the data for the hashing input with the <code>:data</code> keyword argument, it can be given with the dot operator after the schema.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec
  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Hash

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;foo/&quot;</span> <span class="token keyword">do</span>
      hash Post<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token attr-name">algorithm:</span> <span class="token atom symbol">:sha256</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>If all hash identifiers inside of a namespace should use the same algorithm we can also specify the hash algorithm on the respective namespace with the <code>:hash_algorithm</code> keyword argument.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec
  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Hash

  namespace <span class="token string">&quot;http://example.com/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">hash_algorithm:</span> <span class="token atom symbol">:sha256</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;foo/&quot;</span> <span class="token keyword">do</span>
      hash Post<span class="token punctuation">.</span>content
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>When the same hash algorithm should be used throughout the whole id spec, the <code>:hash_algorithm</code> can also specified on the <code>use Grax.Id.Spec</code>.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec<span class="token punctuation">,</span> 
    <span class="token attr-name">hash_algorithm:</span> <span class="token atom symbol">:sha256</span>

  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Hash

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    namespace <span class="token string">&quot;foo/&quot;</span> <span class="token keyword">do</span>
      hash Post<span class="token punctuation">.</span>content
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>All these outer scope <code>:hash_algorithm</code> specifications can be overwritten in inner scopes including the id schema itself.</p> <h2 id="uuids"><a href="#uuids" aria-hidden="true" class="header-anchor">#</a> UUIDs</h2> <p>The <code>Grax.Id.UUID</code> extension provides macros for defining UUID id schemas. The most generic one is the <code>uuid</code> macros and has the following keyword arguments:</p> <ul><li><code>:version</code>: the version of the UUIDs to be generated; it can be 1, 3, 4 or 5 and is required</li> <li><code>:format</code>: the format of the UUIDs to be generated; it can be <code>:default</code> (which also is the default if not specified) or <code>:hex</code>)</li> <li><code>:namespace</code>: the namespace to be used for name-based UUIDs of version 3 and 5; it can be <code>:url</code>, <code>:dns</code>, <code>:oid</code>, , <code>:x500</code>, <code>:nil</code> or another UUID as a string and is required when <code>:version</code> is 3 or 5</li> <li><code>:name_var</code>: the name of the property of the Grax schema whose value should be used as the basis for the name for which the UUID will be generated; required when <code>:version</code> is 3 or 5</li></ul> <p>The generated is available with the <code>uuid</code> variable for the template in the <code>:template</code> keyword argument.</p> <p>We're using our schemas from the last chapters as an example again to demonstrate this.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec
  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>UUID

  <span class="token attribute variable">@custom_uuid_namespace</span> UUID<span class="token punctuation">.</span>uuid5<span class="token punctuation">(</span><span class="token atom symbol">:dns</span><span class="token punctuation">,</span> <span class="token string">&quot;example.domain.com&quot;</span><span class="token punctuation">)</span>

  namespace <span class="token string">&quot;http://example.com/&quot;</span> <span class="token keyword">do</span>
    uuid User<span class="token punctuation">,</span> <span class="token attr-name">template:</span> <span class="token string">&quot;{uuid}&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">version:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token attr-name">format:</span> <span class="token atom symbol">:hex</span>
    uuid Comment<span class="token punctuation">,</span> 
      <span class="token attr-name">template:</span> <span class="token string">&quot;{uuid}&quot;</span><span class="token punctuation">,</span> 
      <span class="token attr-name">version:</span> <span class="token number">5</span><span class="token punctuation">,</span> 
      <span class="token attr-name">namespace:</span> <span class="token attribute variable">@custom_uuid_namespace</span><span class="token punctuation">,</span> 
      <span class="token attr-name">name_var:</span> <span class="token atom symbol">:content</span><span class="token punctuation">,</span>
      <span class="token attr-name">format:</span> <span class="token atom symbol">:hex</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>We can apply all of the techniques we saw in the previous sections to make everything more compact.</p> <ol><li>We can omit the template when it just consists solely of the <code>uuid</code> variable.</li> <li>For the name-based UUIDs in version 3 and 5 we can provide the property for the <code>:name_var</code> with the dot operator after the schema.</li> <li>We can move shared arguments to the namespace by using the equivalent keyword argument just prefixed with the extension name.</li> <li>There are also dedicated macros for the different versions available, which make the <code>:version</code> argument implicit.</li></ol> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> Example<span class="token punctuation">.</span>IdSpec <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec
  <span class="token keyword">import</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>UUID

  <span class="token attribute variable">@custom_uuid_namespace</span> UUID<span class="token punctuation">.</span>uuid5<span class="token punctuation">(</span><span class="token atom symbol">:dns</span><span class="token punctuation">,</span> <span class="token string">&quot;example.domain.com&quot;</span><span class="token punctuation">)</span>

  namespace <span class="token string">&quot;http://example.com/&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">uuid_format:</span> <span class="token atom symbol">:hex</span> <span class="token keyword">do</span>
    uuid4 User
    uuid5 Comment<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token attr-name">namespace:</span> <span class="token attribute variable">@custom_uuid_namespace</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><h2 id="urns"><a href="#urns" aria-hidden="true" class="header-anchor">#</a> URNs</h2> <p>Grax id schemas for URN identifiers can be defined by using any of the macros for the definition of id schemas, but putting them in special URN namespaces. These namespaces can be defined with the <code>urn</code> macro and get a symbol for the namespace identifier instead of a path fragment. The colons before and after the namespace identifier are added automatically, so you won't have to add them in the template.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> UrnIds <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  urn <span class="token atom symbol">:example</span> <span class="token keyword">do</span>
    id User<span class="token punctuation">,</span> <span class="token string">&quot;{name}&quot;</span>
  <span class="token keyword">end</span>

  urn <span class="token atom symbol">:uuid</span> <span class="token keyword">do</span>
    uuid4 Post<span class="token punctuation">.</span>content
  <span class="token keyword">end</span>

  urn <span class="token atom symbol">:sha1</span><span class="token punctuation">,</span> <span class="token attr-name">algorithm:</span> <span class="token atom symbol">:sha</span> <span class="token keyword">do</span>
    hash Post<span class="token punctuation">.</span>content
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>Note, that in the case of the UUID URNs the URN format will be automatically selected. This format is only available in the URN namespaces.</p> <h2 id="blank-nodes"><a href="#blank-nodes" aria-hidden="true" class="header-anchor">#</a> Blank nodes</h2> <p>Grax schemas which should have blank nodes as identifiers can be declared with the <code>blank_node</code> macro in an id spec. It just takes a single Grax schema or a list of Grax schemas as the only argument</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code><span class="token keyword">defmodule</span> UrnIds <span class="token keyword">do</span>
  <span class="token keyword">use</span> Grax<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Spec

  blank_node Address
<span class="token keyword">end</span>
</code></pre></div><p>The generated blank nodes ids will be underscored UUIDs.</p> <div class="language-elixir extra-class"><pre class="language-elixir"><code>iex<span class="token operator">&gt;</span> Address<span class="token punctuation">.</span>build!<span class="token punctuation">(</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">street:</span> <span class="token string">&quot;Marienstraße 11&quot;</span><span class="token punctuation">,</span>
<span class="token operator">...</span>&gt;   <span class="token attr-name">city:</span> <span class="token string">&quot;Berlin&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">%</span>Address<span class="token punctuation">{</span>
  <span class="token attr-name">__id__:</span> ~B<span class="token operator">&lt;</span>_07456224d1074c87a1152f75319593ef<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token attr-name">street:</span> <span class="token string">&quot;Marienstraße 11&quot;</span><span class="token punctuation">,</span>
  <span class="token attr-name">city:</span> <span class="token string">&quot;Berlin&quot;</span>
<span class="token punctuation">}</span>   
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/rdf-elixir/website/edit/master/content/grax/ids.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/grax/api.html" class="prev">
          API
        </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.9947d21f.js" defer></script><script src="/assets/js/2.9c83fda1.js" defer></script><script src="/assets/js/12.6022d75e.js" defer></script><script src="/assets/js/3.6456fe17.js" defer></script>
  </body>
</html>
